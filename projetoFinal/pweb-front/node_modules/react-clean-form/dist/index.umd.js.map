{"version":3,"file":"index.umd.js","sources":["../src/index.tsx"],"sourcesContent":["import * as React from 'react';\n\ntype State = { [s: string]: any };\n\nconst { useState } = React;\n\nexport const useForm = (\n  initialState: State = {},\n): [State, (e: React.SyntheticEvent) => void] => {\n  const [state, setState] = useState(initialState);\n\n  const handleChange = (e: React.SyntheticEvent) => {\n    const target = e.target as typeof e.target & {\n      [s: string]: string;\n    };\n\n    const { name } = target;\n    const newState =\n      e.type === 'reset'\n        ? () => initialState\n        : (state: State) => ({\n            ...state,\n            [name]: target.type === 'checkbox' ? target.checked : target.value,\n          });\n\n    setState(newState);\n  };\n\n  return [state, handleChange];\n};\n\nexport type FormProps = {\n  initialState: State;\n  onSubmit?: (state: State) => void;\n  children?: React.ReactNode;\n} & React.PropsWithoutRef<JSX.IntrinsicElements['form']>;\n\nexport type Ref = HTMLFormElement;\n\ntype CloneFunc = (child: React.ReactNode) => React.ReactNode;\ntype CloneFuncType = 'value' | 'checked';\ntype Cloner = (type: CloneFuncType) => CloneFunc;\ntype CloneTypes = { [s: string]: CloneFunc };\n\nconst CleanForm = React.forwardRef<Ref, FormProps>(\n  ({ initialState = {}, onSubmit = () => {}, children, ...props }, ref) => {\n    const [state, handleChange] = useForm(initialState);\n\n    const cloner: Cloner = type => child => {\n      const defaultFormValues = {\n        value: '',\n        checked: false,\n        radio: false,\n      };\n\n      return child && (child as any).props\n        ? React.cloneElement(child as any, {\n            [type]: state.hasOwnProperty((child as any).props.name)\n              ? state[(child as any).props.name]\n              : (child as any).props[type]\n              ? (child as any).props[type]\n              : defaultFormValues[type],\n            onChange: handleChange,\n            children: React.Children.map(\n              (child as any).props.children,\n              deepMap,\n            ),\n          })\n        : child;\n    };\n\n    const cloneTypes: CloneTypes = {\n      default: cloner('value'),\n      checkbox: cloner('checked'),\n      radio: (child: React.ReactNode): React.ReactNode => {\n        return (child as any).props\n          ? React.cloneElement(child as any, {\n              checked:\n                (child as any).props.value === state[(child as any).props.name],\n              onChange: handleChange,\n              children: React.Children.map(\n                (child as any).props.children,\n                deepMap,\n              ),\n            })\n          : child;\n      },\n    };\n\n    const deepMap = (child: React.ReactNode): React.ReactNode => {\n      const type = child && (child as any).props && (child as any).props.type;\n      return cloneTypes[type]\n        ? cloneTypes[type](child)\n        : cloneTypes.default(child);\n    };\n\n    const newChildren = React.Children.map(children, deepMap);\n\n    return (\n      <form\n        {...props}\n        ref={ref}\n        onSubmit={e => {\n          if (e) e.preventDefault();\n          onSubmit(state);\n        }}\n        onReset={handleChange}\n      >\n        {newChildren}\n      </form>\n    );\n  },\n);\n\nexport default CleanForm;\n"],"names":["useState","React","useForm","initialState","setState","e","target","name","type","state","checked","value","CleanForm","ref","onSubmit","children","props","handleChange","cloner","child","hasOwnProperty","radio","map","deepMap","cloneTypes","checkbox","onChange","newChildren","preventDefault","onReset"],"mappings":"6hCAIQA,EAAaC,WAERC,EAAU,eACrBC,yDAAsB,OAEIH,EAASG,MAArBC,aAmBP,MAjBc,SAACC,OACdC,EAASD,EAAEC,OAITC,EAASD,EAATC,KASRH,EAPa,UAAXC,EAAEG,KACE,kBAAML,GACN,SAACM,yWACIA,OACFF,EAAuB,aAAhBD,EAAOE,KAAsBF,EAAOI,QAAUJ,EAAOK,aAsBnEC,EAAYX,aAChB,WAAiEY,WAA9DV,aAAAA,aAAe,SAAIW,SAAAA,aAAW,eAAUC,IAAAA,SAAaC,+ZACxBd,EAAQC,MAA/BM,OAAOQ,OAERC,EAAiB,SAAAV,UAAQ,SAAAW,gBAOtBA,GAAUA,EAAcH,MAC3Bf,eAAmBkB,UAChBX,EAAOC,EAAMW,eAAgBD,EAAcH,MAAMT,MAC9CE,EAAOU,EAAcH,MAAMT,MAC1BY,EAAcH,MAAMR,GACpBW,EAAcH,MAAMR,GAXL,CACxBG,MAAO,GACPD,SAAS,EACTW,OAAO,GASmBb,mBACZS,kBACAhB,WAAeqB,IACtBH,EAAcH,MAAMD,SACrBQ,QAGJJ,IAGAK,EAAyB,SACpBN,EAAO,SAChBO,SAAUP,EAAO,WACjBG,MAAO,SAACF,UACEA,EAAcH,MAClBf,eAAmBkB,EAAc,CAC/BT,QACGS,EAAcH,MAAML,QAAUF,EAAOU,EAAcH,MAAMT,MAC5DmB,SAAUT,EACVF,SAAUd,WAAeqB,IACtBH,EAAcH,MAAMD,SACrBQ,KAGJJ,IAIFI,EAAU,SAACJ,OACTX,EAAOW,GAAUA,EAAcH,OAAUG,EAAcH,MAAMR,YAC5DgB,EAAWhB,GACdgB,EAAWhB,GAAMW,GACjBK,UAAmBL,IAGnBQ,EAAc1B,WAAeqB,IAAIP,EAAUQ,UAG/CtB,wCACMe,GACJH,IAAKA,EACLC,SAAU,SAAAT,GACJA,GAAGA,EAAEuB,iBACTd,EAASL,IAEXoB,QAASZ,IAERU"}